<Window x:Class="DivinityModManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DivinityModManager.Views"
        xmlns:conv="clr-namespace:DivinityModManager.Converters"
        xmlns:vm="clr-namespace:DivinityModManager.ViewModels;assembly=DivinityModManagerCore"
        xmlns:data="clr-namespace:DivinityModManager.Models;assembly=DivinityModManagerCore"
		xmlns:dd="urn:gong-wpf-dragdrop"
        mc:Ignorable="d"
        Title="{Binding Title, FallbackValue='Divinity Mod Manager'}" Height="450" Width="800" DataContextChanged="Window_DataContextChanged"
		d:DataContext="{d:DesignInstance IsDesignTimeCreatable=True, Type=local:MainWindowDebugData}"
>
	<Window.DataContext>
		<vm:MainWindowViewModel/>
	</Window.DataContext>
	<Window.Resources>
		<conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
		<DataTemplate DataType="{x:Type data:DivinityProfileData}">
			<TextBlock Text="{Binding Name}" />
		</DataTemplate>
		<DataTemplate DataType="{x:Type data:DivinityLoadOrder}">
			<TextBlock Text="{Binding Name}" />
		</DataTemplate>
		<DataTemplate DataType="{x:Type data:DivinityModSeparator}">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>
				<Rectangle Fill="Orange" Opacity="0.2" IsHitTestVisible="False" />
				<TextBlock Text="Unordered Mods:" Background="Transparent" Margin="4" />
				<Separator BorderThickness="1" BorderBrush="Orange" Grid.Row="1" />
			</Grid>
		</DataTemplate>
		<DataTemplate DataType="{x:Type data:DivinityModDependency}">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<TextBlock Text="{Binding Name}" />
				<TextBlock Text="{Binding Version.Version}" Grid.Column="1" />
			</Grid>
		</DataTemplate>
		<DataTemplate DataType="{x:Type data:DivinityModData}">
			<Grid ShowGridLines="True">
				<Grid.Resources>
					<Style TargetType="TextBlock">
						<Setter Property="Background" Value="Transparent" />
						<Setter Property="Padding" Value="4,0,0,0" />
					</Style>
				</Grid.Resources>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="25" SharedSizeGroup="IndexCol" />
					<ColumnDefinition Width="*" SharedSizeGroup="NameCol" />
					<ColumnDefinition Width="50" SharedSizeGroup="VersionCol" />
					<ColumnDefinition Width="50" SharedSizeGroup="AuthorCol" />
				</Grid.ColumnDefinitions>
				
				<!--<NumericUpDown Value="{Binding Index}" Grid.Column="1" Minimum="0" Maximum="{x:Static vm:MainWindowViewModel.StaticMaxOrderIndex}" ClipValueToMinMax="True" />-->
				<Label Content="{Binding Index}" />
				<TextBlock Text="{Binding Name}" Grid.Column="1">
					<TextBlock.Resources>
						<Style TargetType="ToolTip">
							<Setter Property="Visibility" Value="{Binding HasToolTip, Converter={StaticResource BoolToVisibilityConverter}}" />
						</Style>
					</TextBlock.Resources>
					<TextBlock.ToolTip>
						<StackPanel Orientation="Vertical" MaxWidth="700" >
							<TextBlock Text="{Binding Description}" TextWrapping="Wrap" Visibility="{Binding HasDescription, Converter={StaticResource BoolToVisibilityConverter}}" />
							<StackPanel Orientation="Vertical" Margin="2" Visibility="{Binding HasDependencies, Converter={StaticResource BoolToVisibilityConverter}}">
								<TextBlock Text="Dependencies:" FontWeight="Bold" />
								<ListBox ItemsSource="{Binding Dependencies}" Margin="0" Padding="0" BorderThickness="0" />
							</StackPanel>
						</StackPanel>
					</TextBlock.ToolTip>
				</TextBlock>
				<TextBlock Text="{Binding Version.Version}" Grid.Column="2"/>
				<TextBlock Text="{Binding Author}" Grid.Column="3"/>
			</Grid>
		</DataTemplate>
	</Window.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>
		<StackPanel Orientation="Horizontal" Margin="4">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="*" />
				</Grid.ColumnDefinitions>
				<TextBlock Text="Profile" VerticalAlignment="Center" Margin="0,0,4,0" />
				<ComboBox ItemsSource="{Binding Profiles}" SelectedIndex="{Binding SelectedProfileIndex}" Grid.Column="1" 
						  VerticalAlignment="Center" HorizontalAlignment="Stretch" MinWidth="100" MinHeight="16" />
			</Grid>
			<Grid Margin="4,0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="*" />
				</Grid.ColumnDefinitions>
				<TextBlock Text="Mod Order" VerticalAlignment="Center" Margin="0,0,4,0" />
				<ComboBox ItemsSource="{Binding ModOrderList}" SelectedIndex="{Binding SelectedModOrderIndex}" Grid.Column="1" 
						  VerticalAlignment="Center" HorizontalAlignment="Stretch" MinWidth="100" MinHeight="16" />
			</Grid>
		</StackPanel>
		<ListView ItemsSource="{Binding ModOrder}" Grid.Row="1" dd:DragDrop.IsDragSource="True" dd:DragDrop.IsDropTarget="True">
			<ListView.Resources>
				<Style TargetType="{x:Type ListViewItem}">
					<Style.Triggers>
						<DataTrigger Binding="{Binding IsEditorMod}" Value="True">
							<Setter Property="Background">
								<Setter.Value>
									<SolidColorBrush Color="Lime" Opacity="0.2" />
								</Setter.Value>
							</Setter>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</ListView.Resources>
			<ListView.View>
				<GridView>
					<GridView.ColumnHeaderContainerStyle>
						<Style TargetType="{x:Type GridViewColumnHeader}">
							<Setter Property="HorizontalContentAlignment" Value="Left" />
						</Style>
					</GridView.ColumnHeaderContainerStyle>
					<GridView.Columns>
						<GridViewColumn Width="30">
							<GridViewColumn.Header>
								<TextBlock Text="#" />
							</GridViewColumn.Header>
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Index}" />
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn Width="400">
							<GridViewColumn.Header>
								<TextBlock Text="Name" />
							</GridViewColumn.Header>
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Name}" />
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn>
							<GridViewColumn.Header>
								<TextBlock Text="Version" />
							</GridViewColumn.Header>
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Version.Version}" />
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<GridViewColumn>
							<GridViewColumn.Header>
								<TextBlock Text="Author" />
							</GridViewColumn.Header>
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Author}" />
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
					</GridView.Columns>
				</GridView>
			</ListView.View>
		</ListView>
	</Grid>
</Window>
